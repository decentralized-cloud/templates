parameters:
  testDockerComposeFilePath: ""
  coverallsServiceName: ""
  coverallsRepoToken: ""

steps:
  - task: DockerCompose@0
    displayName: "Build Tests"
    inputs:
      dockerComposeFile: ${{ parameters.testDockerComposeFilePath }}
      action: "Build services"

  - task: DockerCompose@0
    displayName: "Run Tests"
    inputs:
      dockerComposeFile: ${{ parameters.testDockerComposeFilePath }}
      dockerComposeFileArgs: |
        COVERALLS_SERVICE_NAME=${{ parameters.coverallsServiceName }}
        COVERALLS_REPO_TOKEN=${{ parameters.coverallsRepoToken }}
      action: "Run services"
      arguments: "tests"
